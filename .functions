alias clip='xclip -selection c'

WORKDIR=~/qustodio
VPNDIR=~/vpn
ANSIBLEDIR=~/qustodio/deployment/ansible

work () {
  if [ -d $WORKDIR/$1 ]
  then
    cd $WORKDIR/$1 &> /dev/null
    workon $1 &> /dev/null
    source vars &> /dev/null
  elif [ -f $VPNDIR/$1 ]
  then
    cd $VPNDIR
    ./$1
  elif [ $1 = 'ansible' ]
  then
    cd $ANSIBLEDIR
    workon $1
  fi
}

deploy () {
  work ansible
  PROJECT=$1
  ENV=$2
  BRANCH=''
  STATUS_VPN=$(osascript ~/vpn/status.scpt $ENV)
  
  if [ $STATUS_VPN != 'CONNECTED' ]; then
    osascript ~/vpn/disconnect.scpt
    osascript ~/vpn/connect_$ENV.scpt
  fi
  if [ $# > 3 ]
  then
    BRANCH=$3
  fi
  COMMAND="-i hosts --limit "$PROJECT"s_"$ENV" -vvvv site.yml"
  if [ "$BRANCH" != '' ]
  then
    COMMAND="$COMMAND -e branch=$BRANCH -e qapi_branch=$BRANCH"
  fi
  echo $COMMAND
  $(ansible-playbook "$COMMAND")
}

go () {
  if [ -d $1 ]; then
    cd $1;
  elif [ -f $1 ]; then
    open $1;
  elif [ -d .git ]; then
    git co $1;
  fi
}
